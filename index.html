<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./images/favicon-32x32.png"
    />
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <style>
      .attribution {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        bottom: -2rem;

        font-size: 11px;
        text-align: center;
      }
      .attribution a {
        color: hsl(228, 45%, 44%);
      }
    </style>

    <link rel="stylesheet" href="css/style.css" />

    <title>Frontend Mentor | Interactive comments section</title>
  </head>
  <body>
    <div class="main-container">
      <div
        x-data="$store.commentsApp"
        x-init="$store.commentsApp.data = await getData()"
        class="comments"
      >
        <ul class="comments_container flow--list">
          <template x-for="comment in $store.commentsApp.data.comments">
            <li x-data="{ isReplyClick: false, ...comment}">
              <div class="comment grid-container">
                <div class="flex comment_header">
                  <picture>
                    <source
                      :srcset="user.image.webp"
                      media="(min-width: 400px)"
                    />
                    <img :src="user.image.png" alt="" />
                  </picture>
                  <p class="comment_username" x-text="user.username"></p>
                  <span x-text="createdAt" class="comment_time-stamp"></span>
                </div>

                <p x-text="content" class="comment_content"></p>

                <div class="flex comment_score">
                  <button>+</button>
                  <span x-text="score" class="comment_score"></span>
                  <button>-</button>
                </div>

                <button
                  @click="isReplyClick = ! isReplyClick"
                  class="comment_reply-btn btn btn-secondary"
                >
                  Reply
                </button>
              </div>

              <template x-if="isReplyClick">
                <div
                  class="comment_reply flex"
                  x-data="{ 
                    replyMessage: user.username.replace(/^/, '@'),
                    ...$store.commentsApp.data.currentUser}"
                >
                  <picture>
                    <source :srcset="image.webp" media="(min-width: 400px)" />
                    <img :src="image.png" alt="" />
                  </picture>

                  <textarea
                    name="comment_reply"
                    id="1"
                    rows="3"
                    x-model="replyMessage"
                  ></textarea>

                  <button
                    @click="$store.commentsApp.saveReply"
                    class="btn btn-primary"
                  >
                    Reply
                  </button>
                </div>
              </template>

              <template x-if="replies.length != 0">
                <ul class="comment_replies-container flow">
                  <template x-for="comment in replies">
                    <li x-data="{isReplyClick: false, ...comment}">
                      <div class="comment grid-container">
                        <div class="flex comment_header">
                          <picture>
                            <source
                              :srcset="user.image.webp"
                              media="(min-width: 400px)"
                            />
                            <img :src="user.image.png" alt="" />
                          </picture>
                          <p
                            class="comment_username"
                            x-text="user.username"
                          ></p>
                          <span
                            x-text="createdAt"
                            class="comment_time-stamp"
                          ></span>
                        </div>

                        <p x-text="content" class="comment_content"></p>

                        <div class="flex comment_score">
                          <button>+</button>
                          <span x-text="score" class="comment_score"></span>
                          <button>-</button>
                        </div>

                        <button
                          @click="isReplyClick = ! isReplyClick"
                          class="comment_reply-btn"
                        >
                          Reply
                        </button>
                      </div>

                      <template x-if="isReplyClick">
                        <div class="comment_reply">
                          <textarea
                            name="comment_reply"
                            id="1"
                            rows="3"
                          ></textarea>
                        </div>
                      </template>
                    </li>
                  </template>
                </ul>
              </template>
            </li>

            <template x-teleport=".comment">
              <div class="flex comment_header">
                <picture>
                  <source
                    :srcset="user.image.webp"
                    media="(min-width: 400px)"
                  />
                  <img :src="user.image.png" alt="" />
                </picture>
                <p class="comment_username" x-text="user.username"></p>
                <span x-text="createdAt" class="comment_time-stamp"></span>
              </div>

              <p x-text="content" class="comment_content"></p>

              <div class="flex comment_score">
                <button>+</button>
                <span x-text="score" class="comment_score"></span>
                <button>-</button>
              </div>

              <button @click="reply = ! reply" class="comment_reply-btn">
                Reply
              </button>
            </template>
          </template>
        </ul>

        <div class="attribution">
          Challenge by
          <a href="https://www.frontendmentor.io?ref=challenge" target="_blank"
            >Frontend Mentor</a
          >. Coded by
          <a href="https://www.frontendmentor.io/profile/edo979">edo979</a>.
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
